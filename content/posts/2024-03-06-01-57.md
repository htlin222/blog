---
title: "Python è‡ªå‹•åŒ–æ‹†åˆ†ç­†è¨˜"
date: "2024-03-06"
template: post
draft: false
description: "åœ¨é€™å€‹è³‡è¨Šçˆ†ç‚¸çš„æ™‚ä»£ï¼Œç®¡ç†å’Œæ•´ç†çŸ¥è­˜è®Šå¾—å°¤ç‚ºé‡è¦ã€‚Zettelkasten ç­†è¨˜æ³•æå€¡å°‡çŸ¥è­˜åˆ†å‰²æˆæœ€å°çš„å–®ä½ä¾†ä¿ƒé€²å­¸ç¿’å’Œå‰µæ–°ã€‚é€™ç¨®æ–¹æ³•å¼·èª¿å°‡å¤§é‡çš„è³‡è¨Šåˆ†è§£æˆæ˜“æ–¼ç®¡ç†å’Œæª¢ç´¢çš„å°éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œç•¶é¢å°ä¸€ä»½é¾å¤§çš„ Markdown æ–‡ä»¶æ™‚ï¼Œæ‰‹å‹•å°‡å…¶æ‹†åˆ†æˆå¤šå€‹å°å–®ä½æ—¢è€—æ™‚åˆä½æ•ˆã€‚å› æ­¤ï¼Œé–‹ç™¼ä¸€å€‹è‡ªå‹•åŒ–å·¥å…·ä¾†åˆ†å‰² Markdown æ–‡ä»¶è®Šå¾—éå¸¸å¿…è¦ï¼Œä»¥ä¾¿æ›´å¥½åœ°éµå¾ª Zettelkasten çš„åŸå‰‡"
category: tutorial
---

# è‡ªå‹•åŒ–æ‹†åˆ†ç­†è¨˜ï¼Œé‡‹æ”¾ Zettelkasten ç­†è¨˜æ³•çš„çœŸæ­£åŠ›é‡

### èƒŒæ™¯

åœ¨é€™å€‹è³‡è¨Šçˆ†ç‚¸çš„æ™‚ä»£ï¼Œç®¡ç†å’Œæ•´ç†çŸ¥è­˜è®Šå¾—å°¤ç‚ºé‡è¦ã€‚Zettelkasten ç­†è¨˜æ³•æå€¡å°‡çŸ¥è­˜åˆ†å‰²æˆæœ€å°çš„å–®ä½ä¾†ä¿ƒé€²å­¸ç¿’å’Œå‰µæ–°ã€‚é€™ç¨®æ–¹æ³•å¼·èª¿å°‡å¤§é‡çš„è³‡è¨Šåˆ†è§£æˆæ˜“æ–¼ç®¡ç†å’Œæª¢ç´¢çš„å°éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œç•¶é¢å°ä¸€ä»½é¾å¤§çš„ Markdown æ–‡ä»¶æ™‚ï¼Œæ‰‹å‹•å°‡å…¶æ‹†åˆ†æˆå¤šå€‹å°å–®ä½æ—¢è€—æ™‚åˆä½æ•ˆã€‚å› æ­¤ï¼Œé–‹ç™¼ä¸€å€‹è‡ªå‹•åŒ–å·¥å…·ä¾†åˆ†å‰² Markdown æ–‡ä»¶è®Šå¾—éå¸¸å¿…è¦ï¼Œä»¥ä¾¿æ›´å¥½åœ°éµå¾ª Zettelkasten çš„åŸå‰‡ã€‚

### æ–¹æ³•

åœ¨é€™è£¡ï¼Œæˆ‘å€‘ä»‹ç´¹äº†ä¸€å€‹åç‚º`split_by_h2`çš„ Python è…³æœ¬ï¼Œç”± Hsieh-Ting Lin é–‹ç™¼ã€‚é€™å€‹è…³æœ¬çš„ç›®çš„æ˜¯è‡ªå‹•åŒ–åœ°å°‡ä¸€ä»½ Markdown æ–‡ä»¶åˆ†å‰²æˆç”±äºŒç´šæ¨™é¡Œï¼ˆH2ï¼‰å®šç¾©çš„å¤šå€‹å°å–®ä½ã€‚é€™å€‹éç¨‹å¤§è‡´å¯ä»¥åˆ†ç‚ºä»¥ä¸‹å¹¾å€‹æ­¥é©Ÿï¼š

1. **è®€å– Markdown æ–‡ä»¶**ï¼šè…³æœ¬é¦–å…ˆè®€å–æŒ‡å®šçš„ Markdown æ–‡ä»¶ï¼Œä¸¦å°‡å…¶å…§å®¹å„²å­˜èµ·ä¾†ã€‚
2. **è™•ç†å…§å®¹**ï¼šé€šéæ­£å‰‡è¡¨é”å¼çš„æ‡‰ç”¨ï¼Œè…³æœ¬åˆªé™¤ç‰¹å®šçš„æ®µè½ï¼ˆä¾‹å¦‚ï¼Œèˆ‡åŒç´šæ¨™é¡Œç›¸é—œçš„å…§å®¹ï¼‰ï¼Œä¸¦æ ¹æ“šä¸€ç´šå’ŒäºŒç´šæ¨™é¡Œåˆ†å‰²æ–‡ä»¶å…§å®¹ã€‚
3. **ç”Ÿæˆæ–°çš„ Markdown æ–‡ä»¶**ï¼šå°æ–¼æ¯å€‹äºŒç´šæ¨™é¡ŒåŠå…¶ç›¸æ‡‰çš„å…§å®¹ï¼Œè…³æœ¬å‰µå»ºä¸€å€‹æ–°çš„ Markdown æ–‡ä»¶ã€‚æ¯å€‹æ–°æ–‡ä»¶åŒ…æ‹¬ä¸€å€‹ YAML é ­éƒ¨ã€ä¾†æºä¿¡æ¯ã€æ¨™é¡Œå’Œå…§å®¹ï¼Œä¸¦åœ¨æ–‡æœ«æ·»åŠ èˆ‡å…¶ä»–æ–‡ä»¶çš„é€£æ¥åˆ—è¡¨ï¼Œä»¥ä¿ƒé€²ç›¸äº’ä¹‹é–“çš„è¯ç¹«ã€‚
4. **æ›´æ–°åŸæ–‡ä»¶**ï¼šåœ¨åŸå§‹ Markdown æ–‡ä»¶ä¸­ï¼Œè…³æœ¬æ›´æ–°ä¸€ç´šæ¨™é¡Œä¸‹çš„å…§å®¹ï¼Œä¸¦åœ¨åº•éƒ¨æ·»åŠ ä¸€å€‹é€£æ¥åˆ°æ–°å‰µå»ºæ–‡ä»¶çš„åˆ—è¡¨ï¼Œæ–¹ä¾¿è·¨æ–‡ä»¶å°èˆªã€‚

```python

import os
import re
from datetime import datetime


class MarkdownProcessor:
    def __init__(self, file_path):
        self.file_path = file_path
        self.original_filename = os.path.basename(file_path).replace(".md", "")
        self.content = self._read_markdown_file()

    def _read_markdown_file(self):
        with open(self.file_path, "r", encoding="utf-8") as f:
            return f.read()

    def _create_new_md_file(self, title, content, yaml_extra=""):
        current_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        yaml_header = f"""---
title: "{title}"
date: "{current_time}"
enableToc: false
tags:
  - building
---

"""
        info_block = f"> [!info]\n>\n> ğŸŒ±ä¾†è‡ªï¼š[[{self.original_filename}]]\n\n"
        return yaml_header + info_block + f"# {title}\n\n{content}"

    def _search_siblings_to_next_heading(
        self, pattern=r"### Siblings.*?(?=\n[#]+ |$)", flags=re.DOTALL
    ):
        match = re.search(pattern, self.content, flags=flags)
        return match.group(0).strip() if match else ""

    def _delete_siblings_from_text(
        self, pattern=r"### Siblings.*?(?=\n[#]+ |$)", flags=re.DOTALL
    ):
        self.content = re.sub(pattern, "", self.content, flags=flags)

    def _get_content_before_first_h2(self):
        match = re.search(r"##(?!#)", self.content)
        if match:
            return self.content[: match.start()].strip()
        else:
            return self.content.strip()

    # def _process_markdown_content(self):
    #     self._delete_siblings_from_text()
    #     pre_h1_content, h1_and_following_content = self.content.split("# ", 1)
    #     h1_title, post_h1_content = h1_and_following_content.split("\n", 1)
    #     between_h1_h2 = self._get_content_before_first_h2()
    #     level_2_heading_pattern = re.compile(r"## (.+?)\n(.*?)(?=\n## |\Z)", re.DOTALL)
    #     level_2_headings = level_2_heading_pattern.findall(post_h1_content)
    #     return pre_h1_content, h1_title, between_h1_h2, level_2_headings
    def _process_markdown_content(self):
        self._delete_siblings_from_text()
        # ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ç›´æ¥åˆ†å‰²å’Œæå–æ‰€éœ€å…§å®¹
        pre_h1_content, h1_title, post_h1_content = re.split(
            r"#\s(.+?)\n", self.content, 1
        )
        between_h1_h2 = self._get_content_before_first_h2()
        # æå–äºŒç´šæ¨™é¡ŒåŠå…¶å¾Œçš„å…§å®¹
        level_2_headings = re.findall(
            r"##\s(.+?)\n(.*?)(?=\n## |\Z)", post_h1_content, re.DOTALL
        )
        return pre_h1_content, h1_title, between_h1_h2, level_2_headings

    def save_new_markdown_files(self):
        pre_h1_content, h1_title, between_h1_h2, level_2_headings = (
            self._process_markdown_content()
        )
        new_md_files = {
            heading: self._create_new_md_file(heading, content)
            for heading, content in level_2_headings
        }

        wikilink_list = "\n".join(
            [
                f"- [[{heading.lower().replace(' ', '_')}.md|{heading}]]"
                for heading in new_md_files
            ]
        )

        for filename, content in new_md_files.items():
            with open(
                f"{filename.lower().replace(' ', '_')}.md", "w", encoding="utf-8"
            ) as f:
                to_write = f"{content}\n\n### Siblings\n\n{wikilink_list}\n\n"
                f.write(to_write)

        main_content_updated = (
            f"{pre_h1_content}# {h1_title}\n{between_h1_h2}\n\n{wikilink_list}\n\n"
        )
        self._update_original_file(main_content_updated)

    def _update_original_file(self, content):
        with open(self.file_path, "w", encoding="utf-8") as f:
            f.write(content)


if __name__ == "__main__":
    import sys

    if len(sys.argv) < 2:
        print("Usage: python script.py <input_file>")
        sys.exit(1)
    file_path = sys.argv[1]
    processor = MarkdownProcessor(file_path)
    processor.save_new_markdown_files()

```

### è¨è«–

ä½¿ç”¨`split_by_h2`è…³æœ¬è‡ªå‹•åŒ–åˆ†å‰² Markdown æ–‡ä»¶å…·æœ‰å¤šæ–¹é¢çš„å¥½è™•ã€‚é¦–å…ˆï¼Œå®ƒåŠ é€Ÿäº†å°‡å¤§æ–‡ä»¶æ‹†åˆ†æˆ Zettelkasten æ–¹æ³•æ¨è–¦çš„å°å–®ä½çš„éç¨‹ï¼Œå¾è€Œç¯€çœäº†å¤§é‡æ™‚é–“å’Œç²¾åŠ›ã€‚å…¶æ¬¡ï¼Œé€™ç¨®æ–¹æ³•å¢å¼·äº†è³‡è¨Šçš„å¯æª¢ç´¢æ€§å’Œå¯é€£æ¥æ€§ï¼Œä½¿å¾—çŸ¥è­˜çš„çµ„ç¹”å’Œç®¡ç†æ›´åŠ é«˜æ•ˆã€‚æœ€å¾Œï¼Œè‡ªå‹•åŒ–å·¥å…·çš„ä½¿ç”¨æ¸›å°‘äº†äººç‚ºéŒ¯èª¤ï¼Œç¢ºä¿äº†åˆ†å‰²éç¨‹çš„ä¸€è‡´æ€§å’Œæº–ç¢ºæ€§ã€‚

### çµè«–

`split_by_h2`è…³æœ¬æ˜¯ä¸€å€‹å¼·å¤§çš„å·¥å…·ï¼Œç”¨æ–¼å°‡å¤§å‹ Markdown æ–‡ä»¶è‡ªå‹•åŒ–åœ°åˆ†å‰²æˆéµå¾ª Zettelkasten ç­†è¨˜æ³•çš„å°å–®ä½ã€‚é€šéç°¡åŒ–åˆ†å‰²éç¨‹ï¼Œå®ƒä¸åƒ…æé«˜äº†çŸ¥è­˜ç®¡ç†çš„æ•ˆç‡ï¼Œè€Œä¸”é‚„å¢å¼·äº†å­¸ç¿’å’Œå‰µæ–°çš„èƒ½åŠ›ã€‚æ­¤è…³æœ¬å°æ–¼é‚£äº›å°‹æ±‚å„ªåŒ–ä»–å€‘çš„ç­†è¨˜å’ŒçŸ¥è­˜ç®¡ç†ç³»çµ±çš„äººä¾†èªªï¼Œæ˜¯ä¸€å€‹æœ‰åƒ¹å€¼çš„è³‡æºã€‚
