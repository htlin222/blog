---
title: "傾向分數配對後調整方法：原理、應用與注意事項 - 以癌症治療研究為例"
date: "2024-09-10"
author: "林協霆"
template: post
draft: false
description: "在觀察性研究中，研究者經常面臨著如何控制混雜因素以獲得可靠因果推斷的挑戰。傾向分數配對（Propensity Score Matching, PSM）作為一種廣泛使用的方法，通過平衡處理組和對照組之間的基線特徵，有效減少了選擇偏差。然而，即使在進行 PSM 後，兩組之間可能仍存在微小但潛在重要的差異。為了解決這一問題，研究者開發了一系列配對後調整方法，其中最常用的包括回歸分析和逆機率加權法（Inverse Probability Weighting, IPW）。"
category: tutorial
---

# 傾向分數配對後調整方法：原理、應用與注意事項 - 以癌症治療研究為例

## 引言

在觀察性研究中，研究者經常面臨著如何控制混雜因素以獲得可靠因果推斷的挑戰。傾向分數配對（Propensity Score Matching, PSM）作為一種廣泛使用的方法，通過平衡處理組和對照組之間的基線特徵，有效減少了選擇偏差。然而，即使在進行 PSM 後，兩組之間可能仍存在微小但潛在重要的差異。為了解決這一問題，研究者開發了一系列配對後調整方法，其中最常用的包括回歸分析和逆機率加權法（Inverse Probability Weighting, IPW）。

為了更好地理解這些方法的應用，我們將以一項比較兩種癌症治療方法（A 和 B）對 5 年存活率影響的研究為例，貫穿整個文章。

研究場景：
假設你正在進行一項比較兩種癌症治療方法（A 和 B）的研究，目的是評估其對 5 年存活率的影響。你使用傾向分數配對（PSM）來平衡治療 A 組和治療 B 組患者的基礎特徵，例如年齡、性別、病程長度等。然而，配對後檢查發現，年齡變數在兩組之間仍然存在統計顯著差異（P < 0.05），這可能會影響治療效果的精確估計。

本文將介紹如何在這種情況下應用配對後調整方法，以進一步提高研究結果的可靠性。我們將重點關注以下幾個方面：

1. 配對後調整的必要性
2. 常用的配對後調整方法
3. 方法選擇的考慮因素
4. 應用步驟和最佳實踐
5. 常見誤區及其避免

## 配對後調整的必要性

在我們的癌症治療研究中，儘管進行了傾向分數配對，年齡變數仍然存在顯著差異。這種情況並不罕見，原因可能包括：

1. 樣本量限制：假設我們的研究只有 500 名患者，可能難以找到完美的配對。
2. 複雜的混雜結構：年齡可能與其他因素（如合併症）有複雜的相互作用。
3. 非線性關係：年齡與存活率可能存在非線性關係，而傾向分數模型可能未能完全捕捉這種關係。

例如，配對後的數據可能如下所示：

治療 A 組：平均年齡 62.5 歲（標準差 10.2）
治療 B 組：平均年齡 60.8 歲（標準差 9.8）
P 值 = 0.03

這種殘餘的不平衡可能導致治療效果估計的偏差。例如，如果較高的年齡與較低的存活率相關，那麼不調整這種差異可能會低估治療 A 的效果。

## 常用的配對後調整方法

### 1. 回歸分析

在我們的癌症研究中，回歸分析可以這樣應用：

步驟：

1. 進行傾向分數配對
2. 在配對樣本上構建 Cox 比例風險模型：
   log(h(t)) = β0 + β1 _治療 + β2_ 年齡 + β3 _性別 + β4_ 病程長度

3. 使用模型估計治療效應（β1）

例子：

```R
# 假設數據集為 matched_data
cox_model <- coxph(Surv(time, event) ~ treatment + age + gender + disease_duration, data = matched_data)
summary(cox_model)
```

結果可能顯示：
治療效應（HR）：0.75 (95% CI: 0.62-0.91, p = 0.003)
年齡效應（每增加 1 歲的 HR）：1.03 (95% CI: 1.02-1.04, p < 0.001)

這表明，在控制年齡等因素後，治療 A 將死亡風險降低了 25%。

### 2. 逆機率加權法（IPW）

對於我們的研究，IPW 可以這樣應用：

步驟：

1. 計算每個患者接受治療 A 的傾向分數（PS）
2. 為治療 A 組患者分配權重：1/PS
3. 為治療 B 組患者分配權重：1/(1-PS)
4. 使用加權樣本進行 Cox 回歸分析

例子：

```R
# 計算傾向分數
ps_model <- glm(treatment ~ age + gender + disease_duration, family = binomial(), data = full_data)
full_data$ps <- predict(ps_model, type = "response")

# 計算權重
full_data$ipw <- ifelse(full_data$treatment == "A", 1/full_data$ps, 1/(1-full_data$ps))

# 加權 Cox 回歸
ipw_cox <- coxph(Surv(time, event) ~ treatment, weights = ipw, data = full_data)
summary(ipw_cox)
```

結果可能顯示：
治療效應（HR）：0.78 (95% CI: 0.65-0.94, p = 0.009)

這個結果與回歸調整的結果略有不同，可能反映了兩種方法處理殘餘不平衡的不同方式。

## 方法選擇的考慮因素

在我們的癌症研究中，選擇方法時需要考慮：

1. 樣本量：
   如果我們有 5000 名患者，IPW 可能更合適。
   如果只有 500 名患者，回歸分析可能更穩定。

2. 不平衡程度：
   假設年齡的標準化均值差為 0.22，屬於中度不平衡，兩種方法都可以考慮。

3. 結果類型：
   我們關注的是生存時間，Cox 回歸和 IPW 都適用。

4. 研究複雜性：
   如果我們懷疑治療效果隨時間變化，可能需要考慮 IPW 結合邊緣結構模型。

5. 數據特徵：
   如果除年齡外，還有許多其他變數（如基因標記）顯示不平衡，IPW 可能更適合處理這種高維情況。

## 應用步驟和最佳實踐

以我們的研究為例：

1. 仔細進行傾向分數配對：

   - 包括年齡、性別、病程長度、腫瘤分期等重要預後因素
   - 評估配對質量：發現年齡仍有顯著差異（P = 0.03）

2. 決定進行配對後調整：

   - 年齡是重要的預後因素，標準化均值差 > 0.1

3. 選擇調整方法：

   - 假設樣本量為 2000，兩種方法都可以嘗試
   - 決定同時應用回歸分析和 IPW 以比較結果

4. 進行敏感性分析：

   - 計算 E-value 評估未測量混雜因素的潛在影響
   - 嘗試不同的模型設定，如在回歸模型中加入年齡的二次項

5. 報告結果：

```
治療效果估計：
- 未調整：HR = 0.80 (95% CI: 0.68-0.94)
- 僅 PSM：HR = 0.77 (95% CI: 0.64-0.92)
- PSM + 回歸調整：HR = 0.75 (95% CI: 0.62-0.91)
- PSM + IPW：HR = 0.78 (95% CI: 0.65-0.94)
```

6. 謹慎解釋：
   "在控制年齡等因素後，治療 A 相比治療 B 將死亡風險降低了約 22-25%。然而，仍

需考慮潛在的未測量混雜因素。"

## 常見誤區及其避免

1. 誤區：認為 PSM 已經解決了所有不平衡問題。
   避免：我們檢查了配對後的平衡性，發現年齡仍有差異，因此進行了進一步調整。

2. 誤區：機械地應用方法而不考慮臨床背景。
   避免：我們選擇包括年齡在調整模型中，因為它在癌症預後中有重要的臨床意義。

3. 誤區：忽視處理效應的異質性。
   避免：考慮進行亞組分析，如檢查治療效果是否因年齡組別（<60 歲 vs. ≥60 歲）而異。

4. 誤區：過度解釋因果關係。
   避免：在結論中明確指出："雖然我們的分析顯示治療 A 可能更有效，但由於研究的觀察性質，無法完全排除未知混雜因素的影響。需要隨機對照試驗來確認這一發現。"

## 結論

在我們的癌症治療研究中，配對後調整方法幫助我們更準確地估計了治療效果，同時考慮了殘餘的年齡差異。通過同時使用回歸分析和 IPW，我們得到了更加穩健的結果。這個例子展示了這些方法在實際研究中的應用價值。

然而，重要的是要記住，即使是最先進的統計方法也無法完全消除觀察性研究中的所有偏差。研究者應該始終保持謹慎，考慮潛在的局限性，並將統計分析結果與臨床知識結合起來，做出全面的判斷。

在癌症研究這樣的重要領域，這些方法的審慎應用可以幫助我們更好地理解不同治療方法的效果，為臨床決策提供更可靠的依據。然而，這些發現最終應該通過隨機對照試驗來驗證，以確保患者獲得最佳的治療。
